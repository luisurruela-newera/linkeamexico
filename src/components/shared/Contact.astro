---
import { Icon } from "astro-icon/components";
---

<section id="contact" class="py-10 bg-black text-white/90">
  <div class="container mx-auto">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      <!-- Content  -->
      <div class="flex items-center pb-10">
        <div class="w-full md:max-w-2/3 text-center md:text-left px-3 md:px-0">
          <h2 class="text-3xl md:text-5xl font-bold mb-4">En Contacto</h2>
          <p class="text-white/65">
            Te interesa alguno de mis servicios? Estaré encantado de ayudarte.
            Envíame un mensaje y en breve me pondré en contacto contigo para
            ponernos de acuerdo.
          </p>

          <div class="mt-10 w-fit mx-auto md:w-full">
            <ul class="text-white/65 flex flex-col md:ps-2 gap-2 text-sm">
              <li
                class="flex items-center gap-2 justify-center md:justify-start"
              >
                <Icon
                  name="pixelarticons:home"
                  size={18}
                  class="text-white/50"
                />
                Tabasco, México
              </li>
              <li
                class="flex items-center gap-2 justify-center md:justify-start"
              >
                <Icon
                  name="pixelarticons:device-phone"
                  size={18}
                  class="text-white/50"
                />
                <a
                  href="tel:9932090424"
                  class="hover:text-white transition duration-300 ease-linear"
                  >99 32 09 04 24</a
                >
              </li>
              <li
                class="flex items-center gap-2 justify-center md:justify-start"
              >
                <Icon
                  name="pixelarticons:mail"
                  size={18}
                  class="text-white/50"
                />
                <a
                  href="mailto:luis.urruela@gmail.com"
                  target="_blank"
                  class="hover:text-white transition duration-300 ease-linear"
                  >luis.urruela@gmail.com</a
                >
              </li>
            </ul>
          </div>
        </div>
      </div>
      <!-- Form -->
      <div>
        <form id="contactForm" class="px-8 pt-6 pb-8 mb-4">
          <div class="mb-4">
            <label for="name" class="block text-white/50 text-sm font-bold mb-2"
              >Tu nombre:</label
            >
            <input
              type="text"
              id="name"
              name="name"
              required
              class="border text-sm border-gray-700 w-full py-2 px-3 text-white/70 leading-tight focus:outline-none focus:shadow-outline"
            />
          </div>
          <div class="mb-4">
            <label
              for="phone"
              class="block text-white/50 text-sm font-bold mb-2"
              >Teléfono con Whatsapp:</label
            >
            <input
              type="tel"
              id="phone"
              name="phone"
              class="border text-sm border-gray-700 w-full py-2 px-3 text-white/70 leading-tight focus:outline-none focus:shadow-outline"
            />
          </div>
          <div class="mb-6">
            <label
              for="message"
              class="block text-white/50 text-sm font-bold mb-2">Mensaje:</label
            >
            <textarea
              id="message"
              name="message"
              rows="5"
              required
              class="border text-sm border-gray-700 w-full py-2 px-3 text-white/70 leading-tight focus:outline-none focus:shadow-outline"
              placeholder='Con un "Hola Luis, me interesan tus servicios" es suficiente. Te mandaré mensaje de vuelta.'
            ></textarea>
          </div>
          <div class="flex items-center justify-between">
            <button
              type="submit"
              class="bg-purple-600 hover:bg-purple-800 text-white/95 font-bold cursor-pointer py-2 px-4 focus:outline-none focus:shadow-outline w-full md:w-auto"
            >
              Enviar Mensaje
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</section>

<script>
  const form = document.getElementById("contactForm");

  if (form) {
    form.addEventListener("submit", async (event) => {
      event.preventDefault();

      const formData = new FormData(event.target as HTMLFormElement);
      const data = Object.fromEntries(formData.entries());

      try {
        const response = await fetch("/api/send-whatsapp", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(data),
        });

        if (response.ok) {
          alert("Mensaje enviado. ¡Te contactaremos pronto!");
          const contactForm = document.getElementById(
            "contactForm"
          ) as HTMLFormElement;
          if (contactForm) {
            contactForm.reset();
          }
        } else {
          alert(
            "Hubo un error al enviar el mensaje. Intenta de nuevo más tarde."
          );
        }
      } catch (error) {
        console.error("Error al enviar el formulario:", error);
        alert(
          "Hubo un error al enviar el mensaje. Intenta de nuevo más tarde."
        );
      }
    });
  }
</script>
